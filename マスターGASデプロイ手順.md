# マスターGAS デプロイ手順

全施設管理マスター用のGoogle Apps Script（GAS）をデプロイする手順です。

## 前提条件

✅ マスタースプレッドシートが作成済みであること
✅ 全施設管理者アカウントが登録済みであること

---

## 1. Apps Scriptエディタを開く

1. マスタースプレッドシート（「全施設管理マスター」）を開く
2. メニューから「拡張機能」→「Apps Script」をクリック
3. 新しいタブでApps Scriptエディタが開きます

---

## 2. GASコードを貼り付け

### ファイル名の変更

1. 左側のファイル一覧で「コード.gs」をクリック
2. ファイル名を「**master_gas_code**」に変更

### コードの貼り付け

1. エディタの内容を全て削除
2. `master_gas_code.js`の内容を全てコピー
3. エディタに貼り付け
4. 「Ctrl+S」（Mac: Cmd+S）で保存

---

## 3. プロジェクト名の設定

1. 左上の「無題のプロジェクト」をクリック
2. プロジェクト名を「**全施設管理マスターAPI**」に変更
3. 「名前を変更」をクリック

---

## 4. Web Appとしてデプロイ

### 新しいデプロイの作成

1. 右上の「デプロイ」ボタンをクリック
2. 「新しいデプロイ」を選択
3. 「種類の選択」で歯車アイコンをクリック → 「ウェブアプリ」を選択

### デプロイ設定

以下の設定を行います:

| 項目 | 設定値 |
|------|--------|
| 説明 | 全施設管理マスターAPI v1.0 |
| 次のユーザーとして実行 | 自分（あなたのメールアドレス） |
| アクセスできるユーザー | 全員 |

**重要**: 「アクセスできるユーザー」は「全員」を選択してください。
これにより、アプリからAPIにアクセスできるようになります。

### 権限の承認

1. 「デプロイ」ボタンをクリック
2. 「アクセスを承認」をクリック
3. Googleアカウントを選択
4. 「詳細」をクリック
5. 「（プロジェクト名）に移動」をクリック
6. 「許可」をクリック

### デプロイURLの取得

1. デプロイが完了すると、「ウェブアプリのURL」が表示されます
2. このURLを**必ずコピーしてメモしてください**

**URLの形式**:
```
https://script.google.com/macros/s/【デプロイID】/exec
```

このURLはFlutterアプリの設定で使用します。

---

## 5. 動作確認（任意）

GASが正しくデプロイされているか確認します。

### ログ機能のテスト

1. Apps Scriptエディタで、関数「doPost」を選択
2. 「デバッグ」→「実行」をクリック
3. エラーが出なければOK

---

## 完了

✅ マスターGASのデプロイが完了しました

### 確認事項

以下の情報を確認してください:

- [ ] デプロイURL（`https://script.google.com/macros/s/.../exec`）
- [ ] 全施設管理者のメールアドレス
- [ ] 全施設管理者のパスワード

---

## 次のステップ

FlutterアプリにマスターGASのURLを設定し、全権者ログイン画面を実装します。

---

## トラブルシューティング

### エラー: 「このアプリは確認されていません」

**解決方法**:
1. 「詳細」をクリック
2. 「（プロジェクト名）に移動」をクリック
3. 「許可」をクリック

### エラー: 「アクセス権限がありません」

**解決方法**:
1. スプレッドシートの共有設定を確認
2. GASを実行するGoogleアカウントに編集権限があることを確認

### デプロイURLが見つからない

**解決方法**:
1. 「デプロイ」→「デプロイを管理」をクリック
2. 「有効なデプロイ」タブで「ウェブアプリ」のURLを確認
