# Phase 1: マスタースプレッドシート設計

## 概要
全施設の情報を統合管理するマスタースプレッドシートの設計

## スプレッドシート構成

### シート一覧
1. **施設マスタ** - 登録されている全施設の情報
2. **全施設管理者** - スーパー管理者アカウント
3. **システム設定** - アプリ全体の設定（将来的な拡張用）

---

## 1. 施設マスタシート

### 目的
全施設の基本情報とスプレッドシートIDを管理

### 列構成

| 列 | 列名 | 型 | 必須 | 説明 | 例 |
|----|------|-----|------|------|-----|
| A | 施設ID | テキスト | ○ | 厚労省から付与された施設番号 | 1234567890 |
| B | 施設名 | テキスト | ○ | 施設の正式名称 | さくら作業所 |
| C | 施設管理者名 | テキスト | ○ | 施設管理者の氏名 | 山田太郎 |
| D | 施設メールアドレス | テキスト | ○ | 施設管理者のログインメール | yamada@sakura.com |
| E | 施設パスワード | テキスト | ○ | 施設管理者のパスワード | SecurePass123 |
| F | スプレッドシートID | テキスト | ○ | 施設の勤怠管理シートID | 1abc...xyz |
| G | 年度 | テキスト | ○ | 管理対象年度 | 2024 |
| H | 作成日時 | 日時 | ○ | 施設登録日時 | 2024/12/06 15:00 |
| I | 更新日時 | 日時 | ○ | 最終更新日時 | 2024/12/06 15:00 |
| J | ステータス | テキスト | ○ | 有効/無効 | 有効 |
| K | 備考 | テキスト | - | メモ欄 | - |
| L | ドライブフォルダID | テキスト | ○ | 施設フォルダのID（年度更新用） | 1xyz2abc... |
| M | 施設住所 | テキスト | - | 施設の所在地 | 東京都〇〇区... |
| N | 施設電話番号 | テキスト | - | 施設の連絡先 | 03-1234-5678 |
| O | 契約開始日 | 日時 | - | サービス利用開始日 | 2024/04/01 |
| P | 契約終了日 | 日時 | - | サービス利用終了日 | 2025/03/31 |
| Q | 利用者定員 | 数値 | - | 施設の利用者定員 | 20 |
| R | テンプレートID | テキスト | - | 年度更新用テンプレートのID | 1def2ghi... |

### データ例
```
A: 1234567890
B: さくら作業所
C: 山田太郎
D: yamada@sakura-facility.com
E: SecurePass123
F: 1abc2def3ghi4jkl5mno6pqr7stu8vwx9yz0
G: 2024
H: 2024/12/06 15:00:00
I: 2024/12/06 15:00:00
J: 有効
K: （空欄）
L: 1xyz2abc3def4ghi5jkl6mno7pqr8stu9vwx
M～R: （空欄または任意）
```

### ヘッダー行
1行目: 列名
2行目以降: データ

---

## 2. 全施設管理者シート

### 目的
スーパー管理者アカウントの管理

### 列構成

| 列 | 列名 | 型 | 必須 | 説明 | 例 |
|----|------|-----|------|------|-----|
| A | 管理者ID | テキスト | ○ | 一意の管理者識別子 | ADMIN001 |
| B | 管理者名 | テキスト | ○ | 管理者の氏名 | 鈴木一郎 |
| C | メールアドレス | テキスト | ○ | ログイン用メールアドレス | admin@company.com |
| D | パスワード | テキスト | ○ | ログイン用パスワード | ******** |
| E | 権限レベル | 数値 | ○ | 固定値: 0（全施設管理者） | 0 |
| F | 作成日時 | 日時 | ○ | アカウント作成日時 | 2024/12/06 15:00 |
| G | 更新日時 | 日時 | ○ | 最終更新日時 | 2024/12/06 15:00 |
| H | ステータス | テキスト | ○ | 有効/無効 | 有効 |
| I | 備考 | テキスト | - | メモ欄 | 本社管理者 |

### データ例
```
A: ADMIN001
B: 鈴木一郎
C: suzuki@company.com
D: SuperSecurePass456
E: 0
F: 2024/12/06 15:00:00
G: 2024/12/06 15:00:00
H: 有効
I: 本社管理者
```

### ヘッダー行
1行目: 列名
2行目以降: データ

---

## 3. システム設定シート（将来的な拡張用）

### 目的
アプリ全体の設定を管理

### 列構成

| 列 | 列名 | 型 | 必須 | 説明 | 例 |
|----|------|-----|------|------|-----|
| A | 設定キー | テキスト | ○ | 設定項目の識別子 | app_version |
| B | 設定値 | テキスト | ○ | 設定の値 | 2.0.0 |
| C | 説明 | テキスト | - | 設定の説明 | アプリバージョン |
| D | 更新日時 | 日時 | ○ | 最終更新日時 | 2024/12/06 15:00 |

---

## セキュリティ考慮事項

### パスワード管理
**現在の案**: 平文で保存（スプレッドシートのアクセス権限で保護）

**理由**:
- GASからハッシュ化ライブラリの利用が複雑
- スプレッドシート自体のアクセス権限で保護
- マスタースプレッドシートは管理者のみアクセス可能

**将来的な改善案**:
- SHA-256等でハッシュ化
- 環境変数やSecret Managerの利用

### アクセス権限
- マスタースプレッドシートは全施設管理者のみ編集可能
- 一般の施設管理者・支援者・利用者はアクセス不可
- GAS Web Appを通じてのみデータアクセス

---

## GAS APIエンドポイント設計

### 必要なAPI

1. **POST /master/facility/create**
   - 新規施設登録
   - 施設用スプレッドシート自動生成
   - 施設管理者アカウント作成

2. **GET /master/facilities**
   - 全施設一覧取得（全施設管理者用）

3. **GET /master/facility/{facilityId}**
   - 特定施設の詳細取得

4. **PUT /master/facility/{facilityId}**
   - 施設情報更新

5. **DELETE /master/facility/{facilityId}**
   - 施設の無効化（論理削除）

6. **POST /auth/superadmin/login**
   - 全施設管理者ログイン
   - トークンに権限レベル0を含める

---

## 実装手順

### ステップ1: マスタースプレッドシート作成
1. 新規Googleスプレッドシート作成
2. 3つのシート（施設マスタ、全施設管理者、システム設定）を作成
3. 各シートのヘッダー行を設定

### ステップ2: GASコード作成
1. 新しいGASプロジェクト作成（master_gas_code.js）
2. マスター管理用のAPI実装
3. Web Appとしてデプロイ

### ステップ3: 初期データ投入
1. 全施設管理者アカウントを手動登録
2. テスト用施設データを登録

### ステップ4: 既存GASとの統合
1. 既存のgas_code_v2.jsを修正
2. マスターGASとの連携機能追加
3. 施設IDによるデータ分離

---

## 次の確認事項

実装を始める前に、以下を確認させてください:

### 決定事項

**施設IDの採番ルール**:
- 厚生労働省から付与された施設番号を使用
- 例: `1234567890`（10桁の数値）

**年度更新の運用**:
- 自動生成機能を実装
- アプリから「年度更新」ボタンで新スプレッドシートを自動生成
- Google Drive APIを使用してテンプレートをコピー
- 施設マスタのスプレッドシートIDを自動更新
