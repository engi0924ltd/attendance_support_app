# 出勤支援アプリ - プロジェクトルール

## 絶対ルール

### 1. パフォーマンス最優先
**アプリとGASの読み込み・書き出し速度を何より優先する**
- 一括取得・一括書き込みを使用
- ループ内でのgetRange/setValueを避ける
- 不要なAPI呼び出しを避ける

### 2. GASファイル編集ルール
- **編集対象**: `assets/gas/gas_code_v4.js`
- **編集禁止**: ルート直下の `gas_code_v4.js`, `master_gas_code_*.js` は**バックアップ専用**

### 3. GASデプロイルール（重要）
- **`assets/gas/gas_code_v4.js`** = **施設のスプレッドシート用GAS**
  - 対象シート: マスタ設定、名簿_YYYY、支援記録_YYYY、請求_YYYY など
  - デプロイ方法: 全権管理者画面 → 対象施設の「GAS更新」ボタン
  - **全権管理者シートのGASではない！施設のスプレッドシートのGASを更新する**
- **`master_gas_code_*.js`** = **全権管理者シート用GAS**（通常は編集しない）
- GAS変更後は**必ずどのシートのGASを更新するか明示**すること

### 4. GASデバッグルール
- **GASの「実行数」からログは確認できない**
- デバッグ時は**APIレスポンスにデバッグ情報を含めて**Flutterログで確認する
- `console.log`ではなく、レスポンスの`debug`フィールドに情報を入れる

### 5. デザイン切り替えルール
- ユーザーが「**戻して**」と言ったら、即座に`git checkout main`でスタンダードデザイン（青いグラデーション）に戻す
- ポップなデザインは`feature/pop-design`ブランチで作業
- `main`ブランチ = スタンダードデザイン（青）を維持

### 6. クイックステータス統一ルール（重要）
**支援者画面と施設管理者ダッシュボードのクイックステータスは必ず同じ仕様にする**

| 項目 | カウント方法 | 参照元 |
|------|-------------|--------|
| **出勤予定** | マスタ設定シートD〜J列（曜日別予定）に予定がある人数。**出勤しても減らない固定値** | マスタ設定シート |
| **出勤済** | 支援記録_YYYYシートにその日の記録がある人数 | 支援記録シート |
| **未出勤** | 出勤予定 − 出勤済（予定があるが記録未作成の人数） | 計算値 |
| **記録未** | 支援記録が未入力の人数。**出勤者 + 欠勤・事前連絡あり欠勤**で未入力をカウント | 支援記録シートD列 |

**記録未の詳細ロジック:**
1. 出勤済み（D列が出勤/遅刻/早退など）で支援記録が未入力 → カウント
2. 欠勤・事前連絡あり欠勤（D列）で支援記録が未入力 → カウント
3. まだ出勤していない人（記録なし）→ カウントしない

---

## 詳細ドキュメント

- **実装状況一覧**: `claudedocs/IMPLEMENTATION_STATUS.md`
- **シート構成・プルダウン設定**: `claudedocs/PROJECT_SUMMARY.md`

---

## シート構成（概要）

### 全権管理者シート - 施設マスタ
A:施設ID, B:施設名, C:管理者名, D:メール, E:パスワード, F:スプレッドシートID, G:年度, H:作成日時, I:更新日時, J:ステータス, **K:ChatWork APIキー**, L:フォルダID, M:住所, N:電話, O:契約開始, P:契約終了, Q:定員, R:テンプレートID, S:GAS URL, T:時間設定, U:施設コード, V:施設パスワード

### マスタ設定シート
- 利用者（8行目〜）: A:名前, B:フリガナ, C:契約状態, D〜J:曜日別予定
- 職員（8〜40行目）: V:名前, W:権限, X:メール, Y:パスワード, Z:職種, AA:資格, AB:配置, **AC:雇用形態, AD:退職日**
- プルダウン:
  - N8〜17(体調), O8〜17(睡眠), N31〜40(疲労), O31〜40(ストレス)
  - K44〜55(曜日予定)
  - **T44〜55(資格), U44〜55(職員配置), V44〜55(職種), W44〜55(勤務地), X44〜55(雇用形態)**
  - **AE30〜40(勤怠評価)**

### 支援記録_2025シート
A:日時, B:利用者名, C:予定, D:出欠, E:AM業務, F:PM業務, G:業務連絡, H:体調, I:睡眠, J:出勤コメント, K:疲労, L:ストレス, M:退勤コメント, N-O:予備, P:開始時刻, Q:終了時刻, R:昼休憩, S:15分休憩, T:他休憩, U:実労時間, V:食事, W:欠席対応, X:訪問, Y:送迎, Z:状況, AA:勤務地, AB:記録者, AC:予備, AD:在宅評価, AE:施設外評価, AF:目標, AG:勤務評価, AH:就労評価, AI:意欲, AJ:通信対応, AK:評価, AL:感想

### 名簿_2025シート
A:人数, B:氏名, C:カナ, D:年齢, E:ステータス, F:携帯, **G:ChatWorkルームID**, H:mail, I〜AQ:詳細情報, **AR:自社管理フラグ, AS:上限管理施設名, AT:上限管理施設番号**, AU〜BH:その他情報
